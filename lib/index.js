// Generated by CoffeeScript 1.7.1
var compile, eco, precompile, preprocess, _ref;

_ref = require("./compiler"), compile = _ref.compile, precompile = _ref.precompile;

preprocess = require("./preprocessor").preprocess;

module.exports = eco = function(source) {
  var _base;
  if (eco.cache) {
    return (_base = eco.cache)[source] != null ? _base[source] : _base[source] = compile(source);
  } else {
    return compile(source);
  }
};

eco.cache = {};

eco.preprocess = preprocess;

eco.precompile = precompile;

eco.compile = compile;

eco.render = function(source, data) {
  return (eco(source))(data);
};

if (require.extensions) {
  require.extensions[".eco"] = function(module, filename) {
    var source;
    source = require("fs").readFileSync(filename, "utf-8");
    return module._compile("module.exports = " + (precompile(source)), filename);
  };
}
